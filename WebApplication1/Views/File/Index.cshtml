@using WebApplication1.Models
@model  ImagesModel

@{
    ViewBag.Title = "Index";
    string actionType = "R";
    string actionName = "SchoolEdit";

}
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <!--加入一些自己手寫的簡單jQuery語法-->

</head>
<body>
    @using (Html.BeginForm("Index", "File", FormMethod.Post, new { enctype = "multipart/form-data", name = "myForm" }))
    {
        <input type="hidden" name="ActionType" value="" />
        <input type="hidden" name="ActionName" value="" />
        <!--紀錄是要上傳照片還是資料存檔-->
        <input type="hidden" value="" name="act" />

            <!--選擇檔案後，表單自動提交-->
        <input type="file" value="選擇大頭照" name="images" onchange="uploadPhoto();" multiple />
        <table border="1">

            @foreach (var img in Model.MemberData)
            {
                int index = Model.MemberData.IndexOf(img);
                <tr class="imgitem" test="test">
                    <td>
                        <!--預覽圖-->
                        <img src="@img.FileUrl" width="100" />
                        &nbsp;
                        <input type="hidden" id="imgID" name="MemberData[@index].ID" value="@img.ID" />
                        <input type="hidden" id="imgName" name="MemberData[@index].FileName" value="@img.FileName" />
                        <input type="hidden" id="imgUrl" name="MemberData[@index].FileUrl" value="@img.FileUrl" />
                        <input type="button" class="close"name="removeBtn"  value="移除" />
                    </td>
                </tr>
            }
        </table>

        <hr /><!--我是分隔線-->
        <input type="submit" value="提交" onclick="postForm();" />
    }
    <script type="text/javascript">
        $(function () {
            $('.close').on('click', function () {
                $(this).closest('tr').remove();

                $(".imgitem").each(function (i, elem) {
                    var $link = $(elem).find("input");
                    $link.each(function (x, el) {
                        var beforeName = $(el).attr('name');
                        var chartIndex = beforeName.indexOf('[') + 1;
                        var newName = beforeName.substr(0, chartIndex) + i + beforeName.substr(chartIndex + 1, beforeName.length - chartIndex);
                        $(el).attr('name', newName);
                    });
                })



            });
        })
        //上傳照片
        function uploadPhoto() {
            $("input[name='act']").attr("value", "upload");
            $("input[name='ActionType']").attr("value", "R");
            $("input[name='ActionName']").attr("value", "School");
            //表單提交
            $("form[name='myForm']").submit();
        }

        //提交表單
        function postForm() {
            //更改flag
            $("input[name='act']").attr("value", "post");
        }
        String.prototype.replaceAt = function (index, replacement) {
            return this.substr(0, index) + replacement + this.substr(index + replacement.length);
        }
    </script>
</body>
</html>